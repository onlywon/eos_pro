<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ event.title }} - Workroom</title>
    <style>
        /* [ê¸°ë³¸ í…Œë§ˆ] */
        body { background-color: #1e1e1e; color: #e0e0e0; font-family: 'Suit', sans-serif; margin: 0; }
        .container { max-width: 1100px; margin: 0 auto; padding: 30px; }
        
        /* [í—¤ë”] */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 20px; margin-bottom: 30px; }
        .event-title { font-size: 32px; font-weight: bold; color: #00ff00; margin: 0; }
        .event-meta { color: #888; font-size: 14px; margin-top: 5px; }
        .btn-back { color: #aaa; text-decoration: none; font-size: 14px; border: 1px solid #444; padding: 5px 10px; border-radius: 4px; transition: 0.3s; }
        .btn-back:hover { background: #333; color: white; }

        /* [íƒ­ ë©”ë‰´] */
        .tab-menu { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #333; }
        .tab-btn { 
            padding: 12px 25px; background: #2a2a2a; border: none; color: #888; 
            font-size: 16px; font-weight: bold; cursor: pointer; 
            border-radius: 8px 8px 0 0; transition: 0.3s; margin-bottom: -2px;
        }
        .tab-btn:hover { background: #333; color: white; }
        .tab-btn.active { background: #007acc; color: white; border-bottom: 2px solid #007acc; }

        /* [íƒ­ ì»¨í…ì¸ ] */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* [ë°•ìŠ¤ ìŠ¤íƒ€ì¼] */
        .box { background-color: #252526; padding: 25px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .section-title { color: #007acc; font-size: 18px; font-weight: bold; margin-bottom: 15px; border-left: 4px solid #007acc; padding-left: 10px; }
        
        /* [ê·¸ë¦¬ë“œ] */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }

        /* [í¼ & ë²„íŠ¼] */
        label { display: block; color: #aaa; font-size: 13px; margin-bottom: 5px; }
        .form-input { background: #333; border: 1px solid #444; color: white; padding: 10px; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .btn-save { background: #007acc; color: white; border: none; padding: 12px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        
        /* [ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€] */
        .btn-del { background: #ff4b4b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-del:hover { background: #cc0000; }

        /* [í…Œì´ë¸”] */
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #444; color: #aaa; background: #2a2a2a; }
        td { padding: 12px; border-bottom: 1px solid #333; }

        /* [í…ìŠ¤íŠ¸ ìœ í‹¸] */
        .text-warn { color: #ff4b4b; } .text-safe { color: #00ff00; } .text-yellow { color: #ffeb3b; }
        
        /* [ì´ë¯¸ì§€ (ë„ë©´)] */
        .graph-img { width: 100%; border-radius: 5px; background-color: #fff; margin-bottom: 20px; }
    </style>
    <script>
        function openTab(tabName, btn) {
            var contents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < contents.length; i++) { contents[i].classList.remove("active"); }
            var btns = document.getElementsByClassName("tab-btn");
            for (var i = 0; i < btns.length; i++) { btns[i].classList.remove("active"); }
            document.getElementById(tabName).classList.add("active");
            btn.classList.add("active");
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1 class="event-title">{{ event.title }}</h1>
                <div class="event-meta">{{ event.date }} | {{ event.get_event_type_display }}</div>
            </div>
            <a href="{% url 'index' %}" class="btn-back">â† ëŒ€ì‹œë³´ë“œ</a>
        </div>

        <div class="tab-menu">
            <button class="tab-btn active" onclick="openTab('step1', this)">1. ì¥ì†Œ/ë¬´ëŒ€ ì„¤ê³„</button>
            <button class="tab-btn" onclick="openTab('step2', this)">2. ìŒí–¥/ì¡°ëª… ë¶„ì„</button>
            <button class="tab-btn" onclick="openTab('step3', this)">3. ì¼ì • ê´€ë¦¬</button>
            <button class="tab-btn" onclick="openTab('step4', this)">4. íì‹œíŠ¸</button>
        </div>

        <div id="step1" class="tab-content active">
            <div class="grid-2">
                <div class="box">
                    <div class="section-title">ğŸ—ï¸ ì„¤ê³„ ë°ì´í„° ì…ë ¥</div>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="update_event" value="true">
                        
                        <label style="color:#007acc; margin-top:10px;">ğŸ“ ê³µê°„ ì •ë³´</label>
                        <div class="grid-3">
                            <div><label>ê°€ë¡œ(m)</label>{{ event_form.venue_width }}</div>
                            <div><label>ê¹Šì´(m)</label>{{ event_form.venue_depth }}</div>
                            <div><label>ì²œê³ (m)</label>{{ event_form.venue_height }}</div>
                        </div>

                        <label style="color:#007acc; margin-top:20px;">ğŸª ë¬´ëŒ€ ì •ë³´</label>
                        <div class="grid-3">
                            <div><label>ê°€ë¡œ(m)</label>{{ event_form.stage_width }}</div>
                            <div><label>ê¹Šì´(m)</label>{{ event_form.stage_depth }}</div>
                            <div><label>ë†’ì´(m)</label>{{ event_form.stage_height }}</div>
                        </div>

                        <label style="color:#007acc; margin-top:20px;">âš™ï¸ ì˜µì…˜</label>
                        <div class="grid-3">
                            <div style="grid-column: span 2;"><label>ê°ì„ ë°°ì¹˜ íƒ€ì…</label>{{ event_form.seating_type }}</div>
                            <div><label>ê°ì„ê°„ê²©</label>{{ event_form.table_gap }}</div>
                        </div>
                        <div class="grid-3" style="margin-top:10px;">
                            <div>{{ event_form.has_virgin_road }} ë²„ì§„ë¡œë“œ</div>
                            <div>{{ event_form.has_foh }} FOH</div>
                        </div>
                        
                        <button type="submit" class="btn-save">ì„¤ê³„ ì‹œë®¬ë ˆì´ì…˜ (ì €ì¥)</button>
                    </form>
                </div>

                <div class="box">
                    <div class="section-title">ğŸ“Š ê³µê°„ ë¶„ì„ & ë°°ì¹˜ë„</div>
                    
                    {% if graph_space %}
                        <img src="data:image/png;base64,{{ graph_space }}" class="graph-img">
                    {% endif %}
                    
                    <div style="background:#333; padding:15px; border-radius:5px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <span>ìµœëŒ€ ìˆ˜ìš© ì¸ì›</span>
                            <span class="text-safe" style="font-weight:bold;">{{ space.pax }} ëª…</span>
                        </div>
                        <div style="display:flex; justify-content:space-between;">
                            <span>ë°°ì¹˜ ìˆ˜ëŸ‰</span>
                            <span style="color:white;">{{ space.table_count }} Unit</span>
                        </div>
                    </div>
                    <div style="margin-top:15px;">
                        {% for info in space.infos %}
                            <div style="color:#aaa; font-size:13px;">{{ info }}</div>
                        {% endfor %}
                        {% for warn in space.warnings %}
                            <div class="text-warn" style="font-size:13px;">âš ï¸ {{ warn }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div id="step2" class="tab-content">
            <div class="grid-2">
                <div class="box">
                    <div class="section-title">ğŸ”Š ìŒí–¥ ì»¤ë²„ë¦¬ì§€ (Audio)</div>
                    {% if graph_audio %}
                        <img src="data:image/png;base64,{{ graph_audio }}" class="graph-img">
                    {% endif %}
                    <div style="background:#333; padding:10px; border-radius:5px; margin-bottom:10px;">
                        <strong style="color:#00ff00;">{{ audio.type }}</strong>
                    </div>
                    <table>
                        <tr><td>ë©”ì¸</td><td>{{ audio.specs.main }}</td></tr>
                        <tr><td>ì„œë¸Œ</td><td>{{ audio.specs.sub }}</td></tr>
                        <tr><td>ë”œë ˆì´</td><td>{{ audio.specs.delay }}</td></tr>
                        <tr><td>ì„¸íŒ…ê°’</td><td class="text-yellow">{{ audio.specs.delay_setting }}</td></tr>
                    </table>
                </div>

                <div class="box">
                    <div class="section-title">ğŸ’¡ ì¡°ëª… & ì „ë ¥ (Lighting)</div>
                    {% if graph_light %}
                        <img src="data:image/png;base64,{{ graph_light }}" class="graph-img">
                    {% endif %}

                    <div style="background:#444; color:#fff; padding:10px; border-radius:5px; margin-bottom:10px; text-align:center; font-weight:bold;">
                        {{ gen_info }}
                    </div>

                    <div style="max-height: 250px; overflow-y: auto;">
                        <table>
                            <thead><tr><th>ID</th><th>Fixture</th><th>Addr</th><th>Watt</th></tr></thead>
                            <tbody>
                                {% for fix in light_patch %}
                                <tr>
                                    <td class="text-safe">{{ fix.id }}</td>
                                    <td>{{ fix.fixture }}</td>
                                    <td>{{ fix.addr }}</td>
                                    <td>{{ fix.watt }}W</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div style="text-align:right; margin-top:10px; color:#aaa;">
                        Total Power: <span class="text-warn">{{ light_power }} kW</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="step3" class="tab-content">
            <div class="grid-2">
                <div class="box">
                    <div class="section-title">ğŸ“… í”„ë¡œì íŠ¸ ì¼ì •</div>
                    <table>
                        <thead><tr><th>ë§ˆê°ì¼</th><th>D-Day</th><th>ë‚´ìš©</th><th>ê´€ë¦¬</th></tr></thead>
                        <tbody>
                            {% for task in tasks %}
                            <tr>
                                <td>{{ task.deadline|date:"Y-m-d" }}</td>
                                <td class="text-warn">{{ task.deadline|timeuntil }}</td>
                                <td>{{ task.content }}</td>
                                <td>
                                    <form method="post" style="display:inline;">
                                        {% csrf_token %}
                                        <input type="hidden" name="delete_task" value="true">
                                        <input type="hidden" name="task_id" value="{{ task.id }}">
                                        <button type="submit" class="btn-del">ì‚­ì œ</button>
                                    </form>
                                </td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4" style="text-align:center; padding:20px;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="box" style="height: fit-content;">
                    <div class="section-title">â• ì¼ì • ì¶”ê°€í•˜ê¸°</div>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="add_task" value="true">
                        
                        <label>í•  ì¼ ë‚´ìš©</label>
                        {{ task_form.content }}
                        
                        <label style="margin-top:15px;">ë§ˆê°ì¼</label>
                        {{ task_form.deadline }}
                        
                        <button type="submit" class="btn-save">ì¼ì • ë“±ë¡</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="step4" class="tab-content">
            <div class="box">
                <div class="section-title" style="display:flex; justify-content:space-between;">
                    <span>ğŸ“ íì‹œíŠ¸ (Cue Sheet)</span>
                    <a href="{% url 'export_excel' event.id %}" style="background-color: #217346; color: white; padding: 5px 15px; text-decoration: none; border-radius: 4px; font-size: 14px;">ğŸ“Š ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>
                </div>
                
                <div style="max-height: 500px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #444;">
                    <table>
                        <thead style="position: sticky; top: 0; background:#2a2a2a;">
                            <tr><th width="60">No</th><th>ë‚´ìš©</th><th width="80">ì‹œê°„</th><th>BGM</th><th>Action</th></tr>
                        </thead>
                        <tbody>
                            {% for cue in cues %}
                            <tr>
                                <td class="text-safe">Q{{ cue.order }}</td>
                                <td>{{ cue.content }}</td>
                                <td>{{ cue.duration }}s</td>
                                <td>{{ cue.bgm }}</td>
                                <td><span style="background:#444; padding:2px 6px; border-radius:4px;">{{ cue.action }}</span></td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" style="text-align:center; padding:30px;">íì‹œíŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div style="background:#333; padding:15px; border-radius:5px;">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="save_cue" value="true">
                        <div style="display: flex; gap: 10px;">
                            <div style="width:60px;">{{ form.order }}</div>
                            <div style="flex-grow:1;">{{ form.content }}</div>
                            <div style="width:80px;">{{ form.duration }}</div>
                            <div style="width:150px;">{{ form.bgm }}</div>
                            <div style="width:80px;">{{ form.action }}</div>
                            <button type="submit" class="btn-save" style="width:auto; margin-top:0;">ì¶”ê°€</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>